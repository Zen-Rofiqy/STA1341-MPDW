---
title: "Data Tidak Stasioner"
author: "Angga Fathan Rofiqy"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  rmdformats::downcute:
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: true
    highlight: tango
    code_folding: hide
    toc_depth: 3
    number_sections: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    fig_caption: true
pkgdown:
  as_is: true
---

Kode di `Hide` dalam *default*, untuk menampilkan kode, klik `Code` .

```{r, warning=FALSE, message = FALSE}
#                      -=( Install & Load Package Function )=-
install_load <- function (package1, ...)  {   

   # convert arguments to vector
   packages <- c(package1, ...)

   # start loop to determine if each package is installed
   for(package in packages){

       # if package is installed locally, load
       if(package %in% rownames(installed.packages()))
          do.call('library', list(package))

       # if package is not installed locally, download, then load
       else {
          install.packages(package)
          do.call("library", list(package))
       }
   } 
}
```

```{r}
path <- function(){
  gsub  ( "\\\\",  "/",  readClipboard ()  )
}
#Copy path, Panggil function di console
#Copy r path, paste ke var yang diinginkan
```

```{r}
#Export chart
export.chart <- "C:/Users/Fathan/Documents/Obsidian Vault/2. Kuliah/Smt 5/6. Metode Peramalan Deret Waktu/@Proj/STA1341-MPDW/Pertemuan 5/Chart"
```

# A. Tentang Data

Dataset ini dibangun dari dataset awal yang terdiri dari $600.000$ data transaksi yang dikumpulkan dalam waktu 6 tahun (periode 2014-2019), yang mencatat tanggal dan waktu penjualan, nama merek obat farmasi, dan jumlah yang terjual. Data ini diekspor dari sistem *Point-of-Sale* di apotek individu. Kelompok obat yang dipilih dari dataset (57 obat) diklasifikasikan ke dalam kategori berikut dalam Sistem Klasifikasi Anatomi Terapeutik Kimia (ATC):

1.  `M01AB` - Produk antiinflamasi dan antirheumatik, non-steroid, Turunan asam asetat dan substansi terkait
2.  `M01AE` - Produk antiinflamasi dan antirheumatik, non-steroid, Turunan asam propionat
3.  `N02BA` - Analgesik dan antipiretik lainnya, Asam salisilat dan turunannya
4.  `N02BE/B` - Analgesik dan antipiretik lainnya, Pirazolona dan Anilida
5.  `N05B` - Obat psikoleptik, Obat ansiolitik
6.  `N05C` - Obat psikoleptik, Obat hipnotik dan sedatif
7.  `R03` - Obat untuk penyakit saluran napas obstruktif
8.  `R06` - Antihistamin untuk penggunaan sistemik

Data penjualan diambil ulang dalam periode per jam, per hari, per minggu, dan per bulan. Data sudah diproses sebelumnya, termasuk deteksi dan penanganan outlier serta pengisian data yang hilang. Data yang akan saya gunakan adalah data dalam periode per bulan.

Beberapa waktu yang lalu saya merasa sulit untuk tidur. Kebetulan ada obat `N05C` yang merupakan obat tidur dalam dataset saya. `N05C` merupakan obat penenang, sifat tenang ini yang mungkin membantu seseorang untuk tidur. Ternyata ada obat tipe penenang lainnya, yakni `N05B`.

Kedua obat ini memiliki kesamaan yakni termasuk dalam klasifikasi **ATC N** (*Nervous System*), yang berarti keduanya berhubungan dengan **sistem saraf**. Kedua obat ini termasuk dalam kelompok ***"Psycholeptics drugs,"*** yang berarti keduanya dapat memengaruhi **sistem saraf** dan **suasana hati** pasien.

Namun ada beberapa perbedaan, diantaranya: `N05B` lebih fokus pada **obat penenang** dan pengobatan **gangguan kecemasan**. Sementara `N05C` lebih fokus pada **obat tidur** dan pengobatan **gangguan tidur**. Contoh obat-obatan yang termasuk dalam kategori ini berbeda, dengan `N05B` memiliki contoh obat-obatan penenang seperti *benzodiazepin*, sementara `N05C` memiliki obat tidur seperti *zolpidem*.

**Tujuan Praktikum** kali ini adalah membuat Model Regresi dengan Peubah Lag terbaik. ***Lag*** secara bahasa sendiri memiliki arti **keterlambatan.** Bisa dikatakan ***Lag*** mengacu pada nilai suatu variabel pada **waktu sebelumnya** dalam rangkaian data waktu.

Kali ini saya akan melihat *"Apakah **penjualan** obat penenang `N05B`* *pada **periode*** ***waktu saat inidipengaruhi*** *oleh penjualan obat tidur `N05C`* *pada **periode waktu sebelumnya?**"* Atau *"Apakah **penjualan** obat tidur `N05C`**periodesebelumnya** memiliki **pengaruh signifikan** terhadap **penjualan** obat penenang `N05B`* *pada **periode*** ***waktu saat ini*** **?***.*

## Data Preparation {.tabset}

### Import Data

```{r, warning=FALSE, message = FALSE}
install_load('rio')
raw.data <- import("https://raw.githubusercontent.com/Zen-Rofiqy/STA1341-MPDW/main/Data/MAANG%20Stock%20Prices.csv")
```

### Data Checking

Cek Tipe data.

```{r}
str(raw.data)
```

Semua data Karakter, harus diubah.

Cek Data kosong.

```{r}
sum(is.na(raw.data))
```

Tidak ada data kosong.

### Penyesuaian Tipe Data

Semua tipe data masih berupa character. Harus diubah menjadi tipe data yang sesuai.

```{r, warning=FALSE, message = FALSE}
install_load('dplyr')
data <- raw.data %>%  
  mutate(
    Date = as.Date(raw.data[, 2], format = "%m/%d/%y"), #Mengubah menjadi Date 
    across(3:ncol(raw.data), as.numeric)                #Mengubah menjadi Numerik
  )
str(data)
```

### Rechecking DataÂ 

Cek kembali data kosong.

```{r}
cat('Banyaknya Data Kosong', sum(is.na(data)))
```

Melihat baris, kolom mana data yang kosong.

```{r}
# Mencari indeks baris dan kolom yang mengandung NA
na.idx <- which(is.na(data), arr.ind = TRUE)

# Menampilkan data raw dengan baris dan kolom yang mengandung NA
install_load('kableExtra','DT')
datatable(raw.data[                        # Subsetting
                unique(na.idx[, 1]),   # Vektor indeks baris yang mengandung NA
                unique(na.idx[, 2])  ] # Vektor indeks kolom yang mengandung NA
          )  
```

Ternyata pada baris tersebut ada data karakter text yang merupakan label dari tiap kolomnya. Sehingga ketika diubah ke numerik akan menjadi `NA`. Maka saya akan menghapus baris tersebut.

### Data Cleaned

```{r}
data <- data %>%
  filter(!row_number() %in% unique(na.idx[, 1]))
datatable(data, filter = 'top', 
          options = list(pageLength = 5))
```

## Pemilihan Variabel Saham {.tabset}

### Time Series MAANG

Melihat keseluruhan *Time Series* data saham.

```{r, warning=FALSE, message = FALSE}
install_load('ggplot2','extrafont')
# font_import(); loadfonts() #Run ini sekali aja
theme1 <- list(
  guides(fill="none"), #No Legends
  theme(
  text = element_text(size = 33),
  axis.title = element_text(size=15),
  axis.title.x = element_text(size=33),
  axis.title.y = element_text(size=33),
  axis.text.y = element_text(vjust = .5, face = "bold"),
  plot.title = element_text(hjust = 0.5, size=40),
  panel.background = element_rect(fill = 'transparent'),
  plot.background = element_rect(fill='transparent', color=NA),
  panel.grid.major = element_line(colour = "grey90"),
  axis.line = element_line(linewidth = 2, colour = "grey90"))
)
```

```{r dpi=300, fig1, fig.height = 12, fig.width = 23, fig.align = "center", warning=FALSE, message = FALSE}
install_load('viridis','ggrepel')
#Plot
cts.maang <-
ggplot(data, aes(x=Date, y=`Adj Close`)) + #Data
  geom_line(aes(color=Name), linewidth=1) + #Timeseries
  #Color
    scale_color_viridis(alpha = 0.75, #Opacity
                     begin = 0, #Color pallte scale begins
                     end = 0.9, #Color pallte scale ends
                     direction = -1, #Flip color scale
                     discrete = T, #Discrete Value
                     option = "D") + #Color Palette
  theme1 + #THeme
  labs(x = "\nTahun", y = "Harga Saham (USD)\n") + #Label X & Y
  ggtitle("Time Series MAANG") +
  # Label / legend
  geom_text_repel(
    data=data[data$Date == max(data$Date),], #Posisi di ujung data
    aes(color = Name, label = Name), #Warna garis & label saham
    size = 8, #Ukuran text
    nudge_x = 80, #Posisi Text (kanan 50)
    hjust = 0, #Ujung
    segment.size = 1,               #Ukuran garis
    segment.alpha = .75,             #transparasi garis
    segment.linetype = "dotted",    #Time garis
    box.padding = .4, #Biar label saham nggak dempetan
    segment.curvature = -0.1, #biar garis mulus
    segment.ncp = 8, 
    segment.angle = 60 
  ) +
  #Axis
    coord_cartesian(clip = "off"
  ) +
    scale_x_date( #Sumbu x
    date_breaks = "1 year",  # Menampilkan label setiap tahun
    date_labels = "%Y",  # Format label tahun
    limits = c(as.Date("2018-07-30"), as.Date("2023-12-28"))
    #Tampilin lebih dari 20023-07-28 agar label saham bisa masuk
  ) +
    scale_y_continuous( #Sumbu y
    labels = scales::dollar_format(prefix = "$") #tambahin dolar
  ) +
    annotate( #Buat nandain batas data
    "text", x = as.Date("2023-7-28"), y = 50, 
    label = "28 Juli", size=6
  ) +
  geom_vline( #Buat garis batas data
    xintercept = as.numeric(as.Date("2023-07-28")), 
             linetype = "dotted", color = "red")
cts.maang

#Export Chart
ggsave("01_Time Series MAANG.png", cts.maang, path = export.chart,
        dpi = 300, height = 9, width = 16)
```

```{r}
library(ggplot2)
library(tsibble)
library(tseries)
library(MASS)
```

## Stasioner dalam Rataan dan Ragam

### Plot *Time Series*

```{r fig.height = 9, fig.width = 16, fig.align = "center", message = FALSE, warning=FALSE}
install_load('ggplot2')
plot_stas <- raw.data |> 
  ggplot(aes(x = datum, y = N02BA)) + geom_line() + theme_bw() +
  xlab("Bulan") + ylab("Penjualan Obat N02BA")
plot_stas
mean(stas)
```

Plot deret waktu di atas menunjukkan bahwa data stasioner dalam rataan, ditandai dengan data yang menyebar di sekitar nilai tengahnya (18) dan stasioner dalam ragam, ditandai dengan lebar pita yang cenderung sama.

### Plot ACF

```{r}
acf(stas)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut cenderung *tails off* dan membentuk gelombang sinus.

### Uji ADF

```{r}
tseries::adf.test(stas)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.01 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF.

### Plot Box-Cox

```{r}
index <- seq(1:200)
bc = boxcox(stas~index, lambda = seq(0,4,by=0.01))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

Gambar di atas menunjukkan nilai *rounded value* ($\lambda$) optimum sebesar **1,97** dan pada selang kepercayaan 95% nilai memiliki batas bawah **0,22** dan batas atas **3,73**. Selang tersebut memuat nilai satu sehingga dapat dikatakan bahwa data bangkitan stasioner dalam ragam.

### Partisi Data

#### Bagian 1

```{r}
dt_stas1 <- stas[1:67] |> ts()
mean(dt_stas1)
var(dt_stas1)
```

#### Plot Time Series

```{r}
dt_stas1 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Plot deret waktu di atas menunjukkan bahwa data stasioner dalam rataan, ditandai dengan data yang menyebar di sekitar nilai tengahnya (18) dan stasioner dalam ragam, ditandai dengan lebar pita yang cenderung sama.

#### Plot ACF

```{r}
acf(dt_stas1)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut cenderung *tails off* dan membentuk gelombang sinus.

#### Uji ADF

```{r}
tseries::adf.test(dt_stas1)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.043 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF.

#### Plot Boxcox

```{r}
index <- seq(1:67)
bc = boxcox(dt_stas1~index, lambda = seq(-2,6,by=1))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

Gambar di atas menunjukkan nilai *rounded value* ($\lambda$) optimum sebesar **2,2** dan pada selang kepercayaan 95% nilai memiliki batas bawah **-1,03** dan batas atas **5,52**. Selang tersebut memuat nilai satu sehingga dapat dikatakan bahwa data bangkitan stasioner dalam ragam.

#### Bagian 2

```{r}
dt_stas2 <- stas[1:134] |> ts()
mean(dt_stas2)
var(dt_stas2)
```

#### Plot Time Series

```{r}
dt_stas2 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Plot deret waktu di atas menunjukkan bahwa data stasioner dalam rataan, ditandai dengan data yang menyebar di sekitar nilai tengahnya (18) dan stasioner dalam ragam, ditandai dengan lebar pita yang cenderung sama.

#### Plot ACF

```{r}
acf(dt_stas2)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut cenderung *tails off* dan membentuk gelombang sinus.

#### Uji ADF

```{r}
adf.test(dt_stas2)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.01 yang lebih kecil dari taraf nyata 5% sehingga tolak $H_0$ dan menandakan bahwa data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF.

#### Plot Boxcox

```{r}
index <- seq(1:134)
bc = boxcox(dt_stas2~index, lambda = seq(0,6,by=1))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

Gambar di atas menunjukkan nilai *rounded value* ($\lambda$) optimum sebesar **2,85** dan pada selang kepercayaan 95% nilai memiliki batas bawah **0,48** dan batas atas **5,27**. Selang tersebut memuat nilai satu sehingga dapat dikatakan bahwa data bangkitan stasioner dalam ragam.

## Tidak Stasioner dalam Rataan, Stasioner dalam Ragam

Bagaimana cara mensimulasikan data dengan tren tertentu?

Kunci dari simulasi tersebut berada di $Y_{t}-Y_{t-1}$, atau *first difference*, atau selisih antara observasi di waktu ke $t$ dan observasi sebelumnya. Jika suatu deret waktu memiliki tren naik, misal, maka selisih tersebut akan positif. Sebaliknya, jika suatu deret memiliki tren turun, maka selisih akan negatif. Jika suatu deret stasioner, selisih akan memiliki rata-rata nol.

Ini dapat diilustrasikan dengan fungsi `cumsum`. `cumsum` adalah jumlah kumulatif. Untuk mengerti logika dari pengunaan jumlah kumulatif, bayangkan ada deret waktu dengan nilai awal $c$:

$$
Y_1 = c
$$

Lalu definsikan $d_i$, di mana $i = 2, 3, \ldots$ sebagai selisih observasi ke-i dengan observasi sebelumnya:

$$
d_i = Y_i-Y_{i-1}
$$

Perhatikan bahwa:

$$
\begin{aligned}
Y_3-Y_{1} & = d_3+d_2\\
&= Y_3-Y_2+Y_2-Y_1
\end{aligned}
$$

Cukup jelas bahwa sifat tersebut berarti:

$$
\begin{aligned}
Y_t-Y_1 &= \sum_{i=2}^t d_i\\
Y_t &= Y_1 + \sum_{i=2}^t d_i
\end{aligned}
$$

Atau, amatan di waktu ke $t$ dapat ditemukan dari menambahkan amatan ke-1 dengan jumlah kumulatif perbedaan $d_i$ sampai di waktu ke-t. Kode di bawah membuat data dengan proses tersebut. Ada tiga skenario, yaitu:

1.  Selisih antara observasi dan observasi sebelumnya nol

2.  Selisih antara observasi dan observasi sebelumnya positif

3.  Selisih antara observasi dan observasi sebelumnya negatif

Dengan nilai awal 1 dan komponen $e_t$ menyebar normal.

```{r}
notrend <- 1 + cumsum(rep(0, 100)) + rnorm(100) |> ts()
postrend <- 1 + cumsum(rep(0.2, 100)) + rnorm(100) |> ts() 
negtrend <- 1 + cumsum(rep(-0.2, 100)) + rnorm(100) |> ts()
```

Hasil yang muncul dapat di-plot (note, untuk plotting ini digunakan `ggplot2`; `ts.plot()` dapat digunakan - ini tergantung preferensi saja):

```{r}
plot_notrend <- notrend |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai") + ggtitle("First Difference = 0")
plot_postrend <- postrend |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai") + ggtitle("First Difference = 0.2")
plot_negtrend <- negtrend |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai") + ggtitle("First Difference = -0.2")

ggpubr::ggarrange(plot_notrend, plot_postrend, plot_negtrend, nrow = 3)
```

Dapat disimulasikan proses MA atau AR yang tidak stasioner dengan suatu tren dengan mensimulasikan beda terlebih dahulu (menggunakan `arima.sim`), ditambah suatu konstanta, lalu mencari jumlah kumulatif. Terdapat juga parameter `mean` di fungsi `arima.sim`, tetapi parameter ini adalah parameter untuk $E[e_t]$, bukan $E[Y_t-Y_{t-1}]$. Proses dari nilai harapan *white noise* tertentu menjadi nilai harapan $Y$ di suatu proses MA atau AR yang tak stasioner sangat tergantung pada model, yang diilustrasikan [di sini](https://stats.stackexchange.com/questions/294748/arima-sim-again-what-does-the-mean-parameter-do-in-an-ma1-sim/).

```{r}
startSpot <- 3
dt <- {arima.sim(n=100, list(order=c(1,0,1),ar=c(.2), ma=.2), sd=2) + 1.5}  |> ts()
yt <- startSpot + cumsum(dt) |> ts()

dt_alt <- arima.sim(n=100, list(order=c(1,0,1),ar=c(.2), ma=.2), mean = 1.5, sd=2)  |> ts()
yt_alt <- startSpot + cumsum(dt_alt) |> ts()

plot_dt <- dt |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai") + ggtitle("Penambahan konstanta 1.5 di selisih")
plot_yt <- yt |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
plot_dt_alt <- dt_alt |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai") + ggtitle("Mean 1.5 di parameter arima.sim")
plot_yt_alt <- yt_alt |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) + geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")

ggpubr::ggarrange(plot_dt, plot_yt, plot_dt_alt, plot_yt_alt)
```

Terlihat di contoh di atas bahwa menambahkan konstanta 1.5 pada hasil `arima.sim` beda dengan memasukkan parameter `mean = 1.5`.

### Data Bangkitan Baru

```{r}
set.seed(8990)
dt_alt <- arima.sim(n=200, list(order=c(1,0,1),ar=c(.2), ma=.2), mean=0.2, sd=0.5)  |> ts()
postrend <- startSpot + cumsum(dt_alt) |> ts()
```

### Plot Time Series

```{r}
postrend |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
mean(postrend)
var(postrend)
```

Berdasarkan plot time series tersebut, terlihat bahwa data tidak stasioner dalam rataan, ditandai dengan adanya tren positif, tetapi stasioner dalam ragam, ditandai dengan adanya lebar pita pada plot yang cenderung sama.

```{r}
ts.plot(diff(postrend))
```

### Plot ACF

```{r}
acf(postrend)
```

### Uji ADF

```{r}
adf.test(postrend)
```

### Plot Box-Cox

```{r}
index <- seq(1:200)
bc = boxcox(postrend~index, lambda = seq(0.8,1.1,by=0.001))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

### Partisi Data

#### Bagian 1

```{r}
postrend1 <- postrend[1:150] |> ts()
mean(postrend1)
var(postrend1)
```

#### Plot Time Series

```{r}
postrend1 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line()+theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

#### Plot ACF

```{r}
acf(postrend1)
```

#### Uji ADF

```{r}
adf.test(postrend1)
```

#### Plot Boxcox

```{r}
index <- seq(1:150)
bc = boxcox(postrend1~index, lambda = seq(0.8,1.4,by=0.001))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

#### Bagian 2

```{r}
postrend2 <- postrend[51:200] |> ts()
mean(postrend2)
var(postrend2)
```

#### Plot Time Series

```{r}
postrend2 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

#### Plot ACF

```{r}
acf(postrend2)
```

#### Uji ADF

```{r}
adf.test(postrend2)
```

#### Plot Boxcox

```{r}
index <- seq(1:150)
bc = boxcox(postrend2~index, lambda = seq(-1,1.2,by=0.001))
#Nilai Rounded Lambda
lambda <- bc$x[which.max(bc$y)]
lambda
#SK
bc$x[bc$y > max(bc$y) - 1/2 * qchisq(.95,1)]
```

## Tidak Stasioner dalam Ragam, Stasioner dalam Rataan

`arima.sim` memiliki parameter sd yang dapat di-set beda.

```{r}
set.seed(9089)
sd1 <- arima.sim(n=100, list(order=c(1,0,1),ar=c(.2), ma=.2), sd = 1)
sd5 <- arima.sim(n=100, list(order=c(1,0,1),ar=c(.2), ma=.2), sd = 5)
dtgab <- c(sd1,sd5) |> ts()
```

### Plot Time Series

```{r}
dtgab |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Berdasarkan plot time series tersebut, terlihat bahwa data stasioner dalam rataan, ditandai dengan tidak adanya trend ataupun musiman pada data, namun tidak stasioner dalam ragam, ditandai dengan adanya perbedaan lebar pita pada plot

### Plot ACF

```{r}
acf(dtgab)
```

Berdasarkan plot ACF, terlihat bahwa data stasioner dalam rataan, ditandai dengan plot ACF yang *tails off* dan cenderung membentuk gelombang sinus

### Uji ADF

```{r}
adf.test(dtgab)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.01 yang kurang dari taraf nyata 5% dan menandakan bahwa data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF

### Partisi Data

#### Bagian 1

```{r}
dtgab1 <- dtgab[1:66] |> ts()
mean(dtgab1)
var(dtgab1)
```

#### Plot Time Series

```{r}
dtgab1 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Berdasarkan plot time series tersebut, terlihat bahwa data cenderung stasioner dalam rataan, ditandain dengan tidak adanya trend dan musiman pada data, serta stasioner dalam ragam, ditandai dengan lebar pita yang cenderung sama pada plot tersebut

#### Plot ACF

```{r}
acf(dtgab1)
```

Berdasarkan plot ACF, terlihat bahwa data cenderung stasioner dalam rataan ditandai dengan plot ACF yang *tails off* dan cenderung membentuk gelombang sinus

#### Uji ADF

```{r}
adf.test(dtgab1)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.01691 yang kurang dari taraf nyata 5% dan menandakan bahwa data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF

#### Plot Boxcox

#### Bagian 2

```{r}
dtgab2 <- dtgab[1:132] |> ts()
mean(dtgab2)
var(dtgab2)
```

#### Plot Time Series

```{r}
dtgab2 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Berdasarkan plot data deret waktu tersebut, terlihat bahwa data stasioner dalam rataan, ditandai dengan data yang tidak menunjukkan adanya trend ataupun musiman, serta tidak stasioner dalam ragam ditandai dengan lebar pita pada plot yang cenderung berbeda di beberapa periode waktunya

#### Plot ACF

```{r}
acf(dtgab2)
```

Berdasarkan plot ACF tersebut, terlihat bahwa data stasioner dalam rataan ditandai dengan plot ACF yang *cuts off* pada lag ke 2

#### Uji ADF

```{r}
adf.test(dtgab2)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.01383 yang kurang dari taraf nyata 5% dan menandakan bahwa data stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF

## Tidak Stasioner dalam Rataan dan Ragam

Hal ini dapat disimulasikan dengan membangkitkan data yang tidak stasioner dalam ragam lalu membentuk trend menggunakan data tersebut

```{r}
set.seed(8990)
sd2 <- arima.sim(n=100, list(order=c(1,0,1),ar=c(.2), ma=.2), sd = 2)
sd6 <- arima.sim(n=100, list(order=c(1,0,1),ar=c(.2), ma=.2), sd = 6)
datagab <- c(sd2,sd6)
dt_rg <- startSpot + cumsum(datagab) |> ts() 
```

### Plot Time Series

```{r}
dt_rg |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Berdasarkan plot time series tersebut, terlihat bahwa data tidak stasioner dalam rataan, ditandai dengan adanya trend pada data dan tidak stasioner dalam ragam, ditandai dengan adanya perbedaan lebar pita pada plot

### Plot ACF

```{r}
acf(dt_rg)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut menurun secara perlahan (*tails off slowly*) yang menandakan data tidak stasioner dalam rataan

### Uji ADF

```{r}
adf.test(dt_rg)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.6447 yang lebih besar dari taraf nyata 5% dan menandakan bahwa data tidak stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF

### Partisi Data

#### Bagian 1

```{r}
dt_rg1 <- dt_rg[1:66] |> ts()
mean(dt_rg1)
var(dt_rg1)
```

#### Plot Time Series

```{r}
dt_rg1 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Berdasarkan plot time series tersebut, terlihat bahwa data tidak stasioner dalam rataan karena masih terdapat tren pada data, namun cenderung stasioner dalam ragam karena memiliki lebar pita yang cenderung sama

#### Plot ACF

```{r}
acf(dt_rg1)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut menurun secara perlahan (*tails off slowly*) yang menandakan data tidak stasioner dalam rataan

#### Uji ADF

```{r}
adf.test(dt_rg1)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.6816 yang lebih besar dari taraf nyata 5% dan menandakan bahwa data tidak stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF

#### Bagian 2

```{r}
dt_rg2 <- dt_rg[67:132] |> ts()
mean(dt_rg2)
var(dt_rg2)
```

#### Plot Time Series

```{r}
dt_rg2 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Berdasarkan plot time series tersebut, terlihat bahwa data tidak stasioner dalam rataan karena masih terdapat tren pada data, dan tidak stasioner dalam ragam karena memiliki lebar pita yang cenderung tidak sama

#### Plot ACF

```{r}
acf(dt_rg2)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut menurun secara perlahan (*tails off slowly*) yang menandakan data tidak stasioner dalam rataan

#### Uji ADF

```{r}
adf.test(dt_rg2)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.9202 yang lebih besar dari taraf nyata 5% dan menandakan bahwa data tidak stasioner dalam rataan. Hal ini sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF

#### Bagian 3

```{r}
dt_rg3 <- dt_rg[133:200] |> ts()
mean(dt_rg3)
var(dt_rg3)
```

#### Plot Time Series

```{r}
dt_rg3 |> as_tsibble() |> 
  ggplot(aes(x = index, y = value)) +
  geom_line() + theme_bw() +
  xlab("Obs") + ylab("Nilai")
```

Berdasarkan plot time series tersebut, terlihat bahwa data tidak stasioner dalam rataan karena masih terdapat tren pada data, namun cenderung stasioner dalam ragam karena memiliki lebar pita yang cenderung sama

#### Plot ACF

```{r}
acf(dt_rg3)
```

Berdasarkan plot ACF, terlihat bahwa plot ACF pada data tersebut menurun secara perlahan (*tails off slowly*)yang menandakan data tidak stasioner dalam rataan

#### Uji ADF

```{r}
tseries::adf.test(dt_rg3, k=10)
```

$H_0$ : Data tidak stasioner dalam rataan

$H_1$ : Data stasioner dalam rataan

Berdasarkan uji ADF tersebut, didapat *p-value* sebesar 0.323 yang lebih besar dari taraf nyata 5% dan menandakan bahwa data tidak stasioner dalam rataan. Hal ini tidak sesuai dengan hasil eksplorasi menggunakan plot time series dan plot ACF
